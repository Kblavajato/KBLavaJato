<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>KB Lava Jato — Agendamento</title>

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#ff7a00; --muted:#94a3b8;
      --glass: rgba(255,255,255,0.03); --radius:12px; --max-width:980px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071021);color:#e6eef8}
    .wrap{max-width:var(--max-width);margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;margin-bottom:22px}
    .logo{width:72px;height:72px;border-radius:14px;background:linear-gradient(135deg,var(--accent),#ffb16b);display:flex;align-items:center;justify-content:center;font-weight:700;color:#081023}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    main{display:grid;grid-template-columns:1fr 420px;gap:18px}
    @media (max-width:900px){main{grid-template-columns:1fr;}}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--radius);padding:18px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    form{display:grid;gap:12px}
    label{font-size:13px;color:var(--muted)}
    input,select{background:var(--card);border:1px solid rgba(255,255,255,0.03);padding:10px 12px;border-radius:10px;color:inherit;font-size:14px}
    input[type="date"], input[type="time"]{padding:8px}
    .row{display:flex;gap:10px}
    .row .col{flex:1}
    button{background:var(--accent);border:0;padding:10px 14px;border-radius:10px;font-weight:600;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .list{display:flex;flex-direction:column;gap:10px;max-height:60vh;overflow:auto;padding-right:6px}
    .item{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:var(--glass);border:1px solid rgba(255,255,255,0.02)}
    .muted{color:var(--muted);font-size:13px}
    footer{margin-top:16px;color:var(--muted);font-size:12px}
    .hint{font-size:12px;color:var(--muted)}
  </style>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, addDoc, orderBy } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDQyboNI6oc2CSsENMYUWMM4N0A9zcF_NY",
      authDomain: "kb-lava-jato.firebaseapp.com",
      databaseURL: "https://kb-lava-jato-default-rtdb.firebaseio.com",
      projectId: "kb-lava-jato",
      storageBucket: "kb-lava-jato.firebasestorage.app",
      messagingSenderId: "545896027646",
      appId: "1:545896027646:web:635af9813686f445dd1caf",
      measurementId: "G-3T1FFG5L3Z"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.firebaseCollection = collection;
    window.firebaseQuery = query;
    window.firebaseWhere = where;
    window.firebaseGetDocs = getDocs;
    window.firebaseAddDoc = addDoc;
    window.firebaseOrderBy = orderBy;
  </script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <script>
    emailjs.init("go_0mb59RZJWklf3S");
  </script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">KB</div>
      <div>
        <h1>KB Lava Jato — Agendamentos</h1>
        <p class="lead">Preencha o formulário para agendar. O sistema evita horários duplicados e envia confirmação por e-mail.</p>
      </div>
    </header>

    <main>
      <section class="card">
        <form id="agendamentoForm">
          <div class="row">
            <div class="col">
              <label>Nome</label>
              <input id="nome" required />
            </div>
            <div class="col">
              <label>Telefone</label>
              <input id="telefone" required />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Tipo de veículo</label>
              <select id="tipoVeiculo" required>
                <option value="">Selecione...</option>
                <option value="Carro">Carro</option>
                <option value="Moto">Moto</option>
              </select>
            </div>
            <div class="col">
              <label>Placa (opcional)</label>
              <input id="placa" />
            </div>
          </div>

          <div class="row">
            <div class="col">
              <label>Data</label>
              <input id="data" type="date" required />
            </div>
            <div class="col">
              <label>Hora</label>
              <input id="hora" type="time" required />
            </div>
          </div>

          <label>Serviço</label>
          <select id="servico">
            <option value="Lavagem simples">Lavagem simples</option>
            <option value="Lavagem completa">Lavagem completa</option>
            <option value="Polimento">Polimento</option>
            <option value="Higienização">Higienização</option>
          </select>

          <div class="row">
            <div class="col">
              <label>E-mail (para confirmação)</label>
              <input id="email" type="email" />
            </div>
            <div class="col">
              <label class="hint">&nbsp;</label>
              <button id="submitBtn" type="submit">Agendar</button>
            </div>
          </div>
          <p class="hint">Ao agendar, o sistema verifica se já existe um horário igual. Só envia e-mail e salva se estiver livre.</p>
        </form>
      </section>

      <aside class="card">
        <h3 style="margin-top:0;margin-bottom:8px">Próximos agendamentos</h3>
        <div id="lista" class="list"><div class="muted">Carregando...</div></div>
        <footer>Os agendamentos aparecem em ordem mais recente primeiro.</footer>
      </aside>
    </main>
  </div>

  <script>
    const form = document.getElementById('agendamentoForm');
    const listaEl = document.getElementById('lista');
    const submitBtn = document.getElementById('submitBtn');

    async function carregarLista(){
      listaEl.innerHTML = '<div class="muted">Carregando...</div>';
      try {
        const q = firebaseQuery(firebaseCollection(db,'agendamentos'), firebaseOrderBy('timestamp','desc'));
        const snap = await firebaseGetDocs(q);
        if (snap.empty) { listaEl.innerHTML = '<div class="muted">Nenhum agendamento encontrado.</div>'; return; }
        listaEl.innerHTML = '';
        snap.forEach(doc => {
          const d = doc.data();
          const el = document.createElement('div');
          el.className = 'item';
          el.innerHTML = `<div><div style="font-weight:600">${d.nome}</div><div class="muted">${d.data} • ${d.hora} — ${d.tipoVeiculo}</div></div><div class="muted">${d.servico}</div>`;
          listaEl.appendChild(el);
        });
      } catch (e){
        console.error(e);
        listaEl.innerHTML = '<div class="muted">Erro ao carregar.</div>';
      }
    }

    form.addEventListener('submit', async (e)=>{
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = 'Salvando...';

      const dados = {
        nome: form.querySelector('#nome').value.trim(),
        telefone: form.querySelector('#telefone').value.trim(),
        tipoVeiculo: form.querySelector('#tipoVeiculo').value,
        placa: form.querySelector('#placa').value.trim(),
        data: form.querySelector('#data').value,
        hora: form.querySelector('#hora').value,
        servico: form.querySelector('#servico').value,
        email: form.querySelector('#email').value.trim(),
        timestamp: new Date()
      };

      try {
        const q = firebaseQuery(firebaseCollection(db,'agendamentos'), firebaseWhere('data','==',dados.data), firebaseWhere('hora','==',dados.hora));
        const snap = await firebaseGetDocs(q);
        if (!snap.empty){
          alert('❌ Este horário já está agendado. Por favor, escolha outro.');
          return;
        }

        try { await emailjs.send('service_r18876j','template_d9x4uep', dados); } catch(err){ console.warn('Falha ao enviar email:', err); }
        await firebaseAddDoc(firebaseCollection(db,'agendamentos'), dados);
        alert('✅ Agendamento realizado com sucesso!');
        form.reset();
        carregarLista();
      } catch(err){ console.error(err); alert('❌ Ocorreu um erro ao agendar.'); }
      finally { submitBtn.disabled = false; submitBtn.textContent = 'Agendar'; }
    });

    carregarLista();
  </script>
</body>
</html>

    const dados = { nome, telefone, placa, veiculo, servico, data, hora };

    // Desativa o botão enquanto processa
    botao.disabled = true;
    botao.textContent = "Enviando...";

    try {
      // Verifica se já existe um agendamento nesse horário
      const agendamentosRef = collection(db, "agendamentos");
      const q = query(agendamentosRef, where("data", "==", data), where("hora", "==", hora));
      const resultado = await getDocs(q);

      if (!resultado.empty) {
        alert("❌ Este horário já está agendado. Por favor, escolha outro.");
        botao.disabled = false;
        botao.textContent = "Agendar";
        return;
      }

      // 1. Envia o e-mail via EmailJS
      await emailjs.send("service_r18876j", "template_d9x4uep", dados);

      // 2. Salva no Firestore
      await addDoc(agendamentosRef, {
        ...dados,
        timestamp: new Date()
      });

      alert("✅ Agendamento realizado com sucesso! Confira seu e-mail 📩");
      form.reset();

    } catch (error) {
      console.error("Erro:", error);
      alert("❌ Ocorreu um erro. Tente novamente.");
    }

    // Reativa o botão
    botao.disabled = false;
    botao.textContent = "Agendar";
  });
</script>


</body>
</html>    }
    form { max-width:500px; margin:0 auto; display:flex; flex-direction:column; gap:15px; }
    form input, form select, form textarea { padding:10px; font-size:1em; border:1px solid #ccc; border-radius:5px; resize:vertical; }
    footer { background:#222; color:#fff; padding:40px 20px; text-align:center; }
    .footer-content a { color:#25D366; text-decoration:none; }
    .footer-content a:hover { text-decoration:underline; }
  </style>
</head>
<body>

<header>
  <img src="1.png" alt="KB Lava Jato" class="logo" />
  <nav>
    <a href="#intro">Início</a>
    <a href="#sobre">Sobre</a>
    <a href="#servicos">Serviços</a>
    <a href="#galeria">Galeria</a>
    <a href="#avaliacoes">Avaliações</a>
    <a href="#contato">Contato</a>
    <a href="#agendamento">Agendamento</a>
  </nav>
</header>

<section class="hero">
  <img src="2.png" alt="Banner KB Lava Jato" />
</section>

<section class="intro" id="intro">
  <h1>Bem-vindo ao KB Lava Jato</h1>
  <p>Especialistas em lavagem automotiva de qualidade: simples, completa, detalhada e polimento profissional.</p>
  <div class="buttons">
    <a href="https://instagram.com/kevin.ribeirod" target="_blank" class="instagram"><i class="fa-brands fa-instagram"></i> Instagram</a>
  </div>
</section>

<section class="sobre" id="sobre">
  <h2>Sobre o KB Lava Jato</h2>
  <p>O <strong>KB Lava Jato</strong> nasceu com o propósito de oferecer um atendimento diferenciado e serviços de qualidade para quem valoriza o cuidado com seu veículo...</p>
</section>

<section class="servicos" id="servicos">
  <h2>Nossos Serviços</h2>
  <table>
    <thead>
      <tr>
        <th>Serviço</th>
        <th>Descrição</th>
        <th>Preço</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td data-label="Serviço">Lavagem Simples</td>
        <td data-label="Descrição">Remoção básica de sujeiras externas com jato d'água e shampoo neutro.</td>
        <td data-label="Preço" class="price">R$ 20,00</td>
      </tr>
      <tr>
        <td data-label="Serviço">Lavagem Completa</td>
        <td data-label="Descrição">Lavagem externa e interna com aspiração, painel, vidros e rodas.</td>
        <td data-label="Preço" class="price">R$ 40,00</td>
      </tr>
      <tr>
        <td data-label="Serviço">Lavagem Detalhada</td>
        <td data-label="Descrição">Higienização minuciosa de cada canto do veículo.</td>
        <td data-label="Preço" class="price">R$ 60,00</td>
      </tr>
      <tr>
        <td data-label="Serviço">Polimento</td>
        <td data-label="Descrição">Restauração do brilho da pintura com ceras especiais.</td>
        <td data-label="Preço" class="price">R$ 100,00</td>
      </tr>
    </tbody>
  </table>
</section>

<section class="galeria" id="galeria">
  <h2>Galeria de Fotos</h2>
  <p>Confira alguns momentos do nosso dia a dia e veja a qualidade do nosso serviço.</p>
  <div class="fotos">
    <img src="3.jpg" alt="Lavagem de carro no KB Lava Jato" loading="lazy" />
    <img src="4.jpg" alt="Motocicleta sendo lavada" loading="lazy" />
    <img src="5.jpg" alt="Produtos automotivos" loading="lazy" />
    <img src="6.jpg" alt="Área externa com veículos aguardando" loading="lazy" />
  </div>
</section>

<section class="avaliacoes" id="avaliacoes">
  <h2>Deixe sua Avaliação</h2>
  <p>Gostou do nosso serviço? Clique no botão abaixo para deixar sua opinião no Google Forms:</p>
  <div class="buttons">
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfRjXz0QMM3ky2I3QoP5Y0Z0Te2xnO6kTrn_slBahCucvTYkw/viewform?usp=header" target="_blank">
      <i class="fa-solid fa-pen-to-square"></i> Avaliar
    </a>
  </div>
</section>

<section class="contato" id="contato">
  <h2>Fale Conosco</h2>
  <p>Preencha abaixo para falar direto conosco!</p>
  <form id="formulario">
    <input type="text" id="nome" placeholder="Seu nome" required />
    <textarea id="mensagem" placeholder="Digite sua mensagem" required></textarea>
    <button type="submit">Enviar Mensagem</button>
  </form>
</section>

<section class="agendamento" id="agendamento">
  <h2>Agende seu Serviço</h2>
  <p>Escolha a data, hora e serviço desejado e envie seu pedido de agendamento.</p>
  <form id="form-agendamento">
    <input type="text" id="agendamento-nome" placeholder="Seu nome" required />
    <input type="tel" id="agendamento-telefone" placeholder="Seu telefone" required />
    <input type="text" id="agendamento-placa" placeholder="Placa do veículo" maxlength="8" required />
    
    <label for="agendamento-veiculo" style="text-align:left;">Tipo de Veículo:</label>
    <select id="agendamento-veiculo" required>
      <option value="">Selecione</option>
      <option value="Carro">Carro</option>
      <option value="Moto">Moto</option>
    </select>

    <label for="agendamento-servico" style="text-align:left;">Serviço:</label>
    <select id="agendamento-servico" required>
      <option value="">Selecione</option>
      <option value="Lavagem Simples">Lavagem Simples</option>
      <option value="Lavagem Completa">Lavagem Completa</option>
      <option value="Polimento">Polimento</option>
    </select>

    <input type="date" id="agendamento-data" required />

    <label for="agendamento-hora" style="text-align:left;">Horário:</label>
    <select id="agendamento-hora" required>
      <option value="">Selecione</option>
      <option>08:00</option>
      <option>09:00</option>
      <option>10:00</option>
      <option>11:00</option>
      <option>13:00</option>
      <option>14:00</option>
      <option>15:00</option>
      <option>16:00</option>
      <option>17:00</option>
    </select>

    <button type="submit">Agendar</button>
  </form>
</section>

<footer>
  <div class="footer-content">
    <div class="footer-contact">
      <h3>Contato</h3>
      <p>
        <a href="https://instagram.com/kevin.ribeirod" target="_blank">
          <i class="fa-brands fa-instagram"></i> @kevin.ribeirod
        </a>
      </p>
    </div>
    <p style="margin-top: 20px; font-size: 0.9em;">&copy; 2025 KB Lava Jato. Todos os direitos reservados.</p>
  </div>
</footer>

<!-- Firebase + EmailJS integrados -->
<script type="module">
  // Firebase SDK v9 (modular)
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // Configuração do Firebase (sua)
  const firebaseConfig = {
    apiKey: "AIzaSyDQyboNI6oc2CSsENMYUWMM4N0A9zcF_NY",
    authDomain: "kb-lava-jato.firebaseapp.com",
    databaseURL: "https://kb-lava-jato-default-rtdb.firebaseio.com",
    projectId: "kb-lava-jato",
    storageBucket: "kb-lava-jato.firebasestorage.app",
    messagingSenderId: "545896027646",
    appId: "1:545896027646:web:635af9813686f445dd1caf",
    measurementId: "G-3T1FFG5L3Z"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // EmailJS (deve já estar incluso via script separado no <head>)
  import emailjs from "https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js";
  emailjs.init("go_0mb59RZJWklf3S"); // Sua public key

  // Formulário de Agendamento
  const form = document.getElementById("form-agendamento");
  const botao = form.querySelector("button");

  form.addEventListener("submit", async function (e) {
    e.preventDefault();

    // Coleta dos dados
    const nome = document.getElementById('agendamento-nome').value;
    const telefone = document.getElementById('agendamento-telefone').value;
    const placa = document.getElementById('agendamento-placa').value.toUpperCase().replace(/\s/g, '');
    const veiculo = document.getElementById('agendamento-veiculo').value;
    const servico = document.getElementById('agendamento-servico').value;
    const data = document.getElementById('agendamento-data').value;
    const hora = document.getElementById('agendamento-hora').value;

    const dados = { nome, telefone, placa, veiculo, servico, data, hora };

    // Desativa o botão enquanto processa
    botao.disabled = true;
    botao.textContent = "Enviando...";

    try {
      // Verifica se já existe um agendamento nesse horário
      const agendamentosRef = collection(db, "agendamentos");
      const q = query(agendamentosRef, where("data", "==", data), where("hora", "==", hora));
      const resultado = await getDocs(q);

      if (!resultado.empty) {
        alert("❌ Este horário já está agendado. Por favor, escolha outro.");
        botao.disabled = false;
        botao.textContent = "Agendar";
        return;
      }

      // 1. Envia o e-mail via EmailJS
      await emailjs.send("service_r18876j", "template_d9x4uep", dados);

      // 2. Salva no Firestore
      await addDoc(agendamentosRef, {
        ...dados,
        timestamp: new Date()
      });

      alert("✅ Agendamento realizado com sucesso! Confira seu e-mail 📩");
      form.reset();

    } catch (error) {
      console.error("Erro:", error);
      alert("❌ Ocorreu um erro. Tente novamente.");
    }

    // Reativa o botão
    botao.disabled = false;
    botao.textContent = "Agendar";
  });
</script>


</body>
</html>
